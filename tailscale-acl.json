{
	// Tailscale ACL Policy
	// Apply this in the Tailscale Admin Console: https://login.tailscale.com/admin/acls
	//
	// Access model:
	// - tag:trusted (matt-desktop): Full access to all devices
	// - tag:cloud (oracle-0): Isolated, can only reach trusted devices on compute ports
	// - autogroup:member (macbook, phone, iPad): Full access via user identity
	"tagOwners": {
		"tag:trusted": ["autogroup:admin"],
		"tag:cloud":   ["autogroup:admin"],
	},
	"acls": [
		// User devices + trusted servers have full access everywhere
		{
			"action": "accept",
			"src":    ["autogroup:member", "tag:trusted"],
			"dst":    ["*:*"],
		},
		// oracle-0 (tag:cloud) can reach matt-desktop (tag:trusted) on compute ports only
		{
			"action": "accept",
			"src":    ["tag:cloud"],
			"dst":    ["tag:trusted:8000-9000"],
		},
	],
	"ssh": [
		// Users can SSH into their own devices, trusted servers, and cloud servers
		{
			"action": "accept",
			"src":    ["autogroup:member"],
			"dst":    ["autogroup:self", "tag:trusted", "tag:cloud"],
			"users":  ["autogroup:nonroot", "root"],
		},
		// Trusted servers can SSH into cloud servers
		{
			"action": "accept",
			"src":    ["tag:trusted"],
			"dst":    ["tag:cloud"],
			"users":  ["autogroup:nonroot", "root"],
		},
	],
	"nodeAttrs": [
		{
			"target": ["autogroup:member", "tag:trusted", "tag:cloud"],
			"attr":   ["drive:share", "drive:access"],
		},
	],
	"grants": [
		// Users and trusted servers can access all Taildrive shares
		{
			"src": ["autogroup:member", "tag:trusted"],
			"dst": ["*"],
			"app": {
				"tailscale.com/cap/drive": [{ "shares": ["*"], "access": "rw" }],
			},
		},
	],
}
